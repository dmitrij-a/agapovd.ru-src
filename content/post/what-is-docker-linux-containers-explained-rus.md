+++
date = "2017-08-15T06:00:00+03:00"
title = "Что такое Docker? Разбор Linux-контейнеров"
comments = true
description = "Краткое введение в легковесные, портабельные и гибкие Docker-контейнеры и почему разработчики их любят"
tags = ["Docker", "LXC", "Linux контейнеры"]
topics = ["Переводы", "Репосты", "IT-Технологии"]
+++

*Перевод статьи "What is Docker? Linux containers explained" ([infoworld.com](http://www.infoworld.com/article/3204171/linux/what-is-docker-linux-containers-explained.html))*

{{% fluid_img "/images/shipping-industry-with-loading-binary-code-containers-on-ship-representing-the-concept-of-software-export-170886508-100265592-primary.idge.jpg" %}}
*(Thinkstock (Thinkstock))*

Linux-котейнеры, так же, как FreeBSD Jails и Solaris Zones, это автономные(замкнутые) окружения, каждая с собственными изолированными ресурсами ЦПУ, памятью, системой блочного ввода/вывода(block I/O), а также сетевыми ресурсами, которые делят общее ядро основной(хостовой) операционной системы. 

Если вы используете виртуальные машины в промышленной системе, то это может означать, что вы вероятно, запускаете много дублирующихся экземпляров(копий) одной и той же операционной системы, а также много избыточных загрузочных томов(логических дисков). Поскольку контейнеры являются более простыми и легковесными по сравнению с виртуальными машинами, вы можете запустить в шесть-восемь раз больше контейнеров чем виртуальных машин на том же железе.

В среде, в которой используются приложения, и которая имеет требования к расширению в соответствии с веб-стандартами, контейнеры являются привлекательным предложением по сравнению с традиционной виртуализацией.
<!--more-->

Чтобы понять контейнеры, мы должны начать с механизмов Linux [cgroups](http://man7.org/linux/man-pages/man7/cgroups.7.html) и пространств имен([namespaces](http://man7.org/linux/man-pages/man7/namespaces.7.html))- возможностей ядра Linux, которые возводят стены между контейнерами а также другими процессами, выполняющимися на одном и том же хосте. Пространства имён в Linux(namespaces), изначально разработанные компанией IBM, оборачивают(инкапсулируют) набор системных ресурсов и предоставляют их процессу таким образом, что для самого процесса эти ресурсы выглядят как будто он имеет к ним выделенный доступ (как будто они выделены специально для него).

Механизм Linux cgroups был изначально разработан компанией Google. Он управляет изолированием и использованием системных ресурсов, таких как ЦПУ и память для группы(набора) процессов. Например, если у вас есть приложение, которое требует много циклов ЦПУ и памяти, например, приложение для расчёта научных данных, вы можете определить для этого приложения так называемую cgroup, чтобы ограничить потребление им ЦПУ и памяти.

Система пространств имён(namespaces) имеет дело с изолированием ресурсов для одного процесса, в то время, как cgroups управляет ресурсами для группы(набора) процессов.

{{% fluid_img "/images/virtualmachines-vs-containers-100727624-large.jpg" %}}
*Из чего складываются виртуализация и стек контейнерной инфраструктуры.*

<h2>От LXC к Docker</h2>

Первоначальная технология Linux-контейнеров, так и называется - Контейнеры Linux(Linux Containers), также более известна как LXC. LXC - это способ виртуализации на системном уровне для операционной системы Linux, для того, чтобы запускать несколько изолированных систем Linux на одном хосте. Механизмы, о которых мы говорили ранее - система пространств имён (namespaces) и управления группами процессов(cgroups), делают LXC возможным.

Контейнеры отвязывают(отцепляют) приложения от операционной системы, что означает, что пользователи могут иметь чистую, минимальную версию операционной системы Linux, и запускать все остальное в одном или нескольких контейнерах.

Также, поскольку операционная система абстрагирована (не связана) от контейнеров, вы можете перемещать контейнеры между Linux-серверами, которые поддерживают среду для исполнения контейнеров.

Docker, который начал как проект для создания LXC-контейнеров основанных на одном приложении, ввёл несколько очень значительных изменений в LXC, которые делают контейнеры ещё более портабельными(независимыми) и гибкими для использования. Используя Docker-контейнеры, вы можете деплоить, реплицировать, перемещать, и поддерживать рабочую нагрузку ещё более быстро и просто, чем вы это можете делать используя виртуальные машины. В целом, Docker предоставляет гибкость сравнимую с использованием облака, для любой инфраструктуры, способной запускать контейнеры.

Именно поэтому, Docker часто упоминается в связи с взрывной популярностью современных(нынешних) контейнерных технологий. Мы заглянем в Docker немного глубже и обсудим что Docker отличает от LXC в разделе ниже. 

<h2>Погружаясь в Docker</h2>

Хотя Docker начался как проект с открытым исходным кодом для создания специализированных LXC, позже он преобразовался в самостоятельную среду для работы контейнеров. На высоком уровне Docker это Linux-утилита, которая может эффективно создавать, доставлять, и запускать контейнеры.

В своей основе и Docker и LXC-контейнеры — это легковесный механизм виртуализации в пользовательском пространстве, который имплементирует cgroups и пространства имен(namespaces) чтобы управлять изоляцией ресурсов. Тем не менее, есть некоторое число ключевых отличий между Docker-контейнерами и LXC. В частности:

**Одно- против многопроцессового**. Docker ограничивает контейнеры для работы как одиночного процесса. Если ваша среда приложений состоит из X конкурентных процессов Docker хочет, чтобы вы запустили X контейнеров, каждый с отдельным процессом. В контраст, LXC-контейнеры имеют общепринятую [процедуру инициализации](http://www.yolinux.com/TUTORIALS/LinuxTutorialInitProcess.html) и могут запускать в несколько процессов.

Чтобы запустить в Docker простое веб-приложение, состоящее из нескольких слоёв, вам понадобится PHP-контейнер, Nginx-контейнер(веб-сервер), MySQL-контейнер (для работы процесса базы данных), а также, несколько контейнеров для хранения таблиц базы данных и других данных приложения.

Преимуществ одно-просецссных контейнеров несколько, включая более простые и гранулированные обновления. Зачем останавливать процесс базы данных, когда всё что вам нужно - обновить веб-сервер? Также, одно-процессные контейнеры предоставляют эффективную архитектуру для построения [приложений основанных на микросервисах](http://www.infoworld.com/article/3200034/application-development/why-you-should-use-microservices.html).

Существуют также и определённые ограничения при использовании однопроцессных контейнеров. Например, вы не можете запускать агенты, скрипты для логгирования, или SSH-демон внутри контейнера. Также, в однопроцессном контейнере не так просто сохранять небольшие изменения уровня приложения. По сути дела, вы вынуждены создавать новый обновлённый контейнер.

**Без сохранения состояния(Stateless) vs. с сохранением состояния(Stateful).** Docker-контейнеры разработаны так, чтобы не сохранять состояние еще больше чем LXC. Во-первых, Docker не поддерживает постоянное хранилище (persistent storage). Docker позволяет это обойти, предлагая вам примонтировать хранилище самого хоста как "Docker-диск(том)" прямо из контейнера. Поскольку диски(тома) примотированы, в действительности они не являются частью контейнерной среды(окружения).

Во-вторых, Docker-контейнеры состоят из слоёв, которые доступны только для чтения. Это означает, что создав однократно образ контейнера, он не меняется. В то время, когда он запущен, если процесс в контейнере меняет внутреннее состояние самого контейнера, создаётся "diff"(список различий) между внутренним состоянием и образом, из которого был создан контейнер. Если вы выполните команду ```docker commit```, этот список различий становится частью нового образа - не оригинального образа, а нового, из которого вы можете создать новые контейнеры. В противном случае, если вы удалите этот контейнер, список различий("diff") пропадёт.

Контейнеры, которые не хранят состояние - очень интересная сущность. Вы можете выполнять обновление контейнера, но череда таких обновлений породит набор новых контейнерных образов, таким образом, откат системы к предыдущему состоянию становится простым.

**Портабельность**. Возможно это свойство является самым важным преимуществом Docker над LXC. Docker больше абстрагирует сетевые ресурсы, хранилище, а также детали работы операционной системы от приложения чем LXC. С Docker приложение становится по-настоящему независимо от того, как сконфигурированы эти низкоуровневые ресурсы. Когда вы перемещаете Docker-контейнер с одного Docker-хоста на другую машину, поддерживающую Docker, Docker гарантирует, что окружение для приложения останется тем же самым.

Прямая выгода от такого подхода в том, что Docker позволяет разработчикам настроить локальное окружение для разработки таким образом, что оно будет в точности таким как на промышленном сервере(продакшн-сервере). Когда разработчик завершает написание и тестирование своего кода, он может обернуть его в контейнер и опубликовать напрямую на AWS сервер или в своё приватное облако, и он(код) будет сразу же работать, так как окружение то же самое.

Даже используя LXC, разработчик может добиться, что что-то будет работать на его собственной машине, но обнаружить, что это не работает так, как надо, когда задеплоит на сервер; окружение на сервере будет отличаться, заставляя разработчика потратить огромное количество времени на отладку различий и исправление проблемы.

Docker устраняет эту запутанность(сложность). Это и есть то, что делает Docker контейнеры такими портабельными и простыми для использования на различных облачных и виртуальных средах.

<h2>Дружественная к разработчику архитектура.</h2>

Отвязка приложений от нижележащего аппаратного обеспечения - основная идея, лежащая за виртуализацией. Контейнеры делают шаг дальше и отвязывают приложения уже от самой операционной системы. Это даёт гибкость сравнимую с облачными сервисами, включая портабельность и возможность эффективного расширения. Контейнеры дают разработчикам новый уровень производительности, портабельности и гибкости деплоймента(разворачивания) по сравнению с виртуализацией.

Популярность контейнеров подчёркивает тот факт, что наступает эра разработчиков(developer-driven). Если появление облаков было про инновации в инфраструктуре, появление мобильных устройств - про инновации в сфере удобства, то контейнеры — это весьма необходимый мультипликатор сил для разработчиков.

*Автор: Chenxi Wang, опытный администратор в сфере технологий/стратегий с глубоким техническим прошлым (Доктор компьютерных наук). В прошлом, главный специалист по стратегии в фирме, занимающейся безопасностью контейнерных технологий - Twistlock, сейчас она работает в экспертом в стартапах, а также в качестве бизнес-ангела.*
